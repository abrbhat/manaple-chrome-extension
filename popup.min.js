function sendAttendanceData(a,b){var c={};chrome.storage.local.get("attendanceData",function(d){c=d.attendanceData,null!=c&&($.each(c,function(a,b){rawImageData=b.photo_data.replace(/^data\:image\/\w+\;base64\,/,""),c[a].photo_data=rawImageData}),$.ajax({type:"POST",url:"http://manaple.com/api/upload_attendance_data.json",headers:{"x-api-email":a,"x-api-token":b},async:"true",data:{attendance_data:c},error:function(){hideSpinner(),$("#message").html("There was an error during data upload. Please try again later."),$("#attendance-data-stored-message").show()},success:function(){hideSpinner(),$("#message").html("Attendance Data Stored on Server"),chrome.storage.local.remove("attendanceData")},beforeSend:function(){$("#attendance-data-stored-message").hide(),$("#message").html("Sending Attendance Data"),showSpinner()}}))})}function setWebcam(){$("#webcam").html(""),Webcam.set({dest_width:400,dest_height:300,image_format:"jpeg",jpeg_quality:90}),Webcam.attach("#webcam"),Webcam.setSWFLocation("/public/webcam.swf")}function setTakePhotoPage(a){$(".page").hide(),$("#take-photo-page").show(),setWebcam(),showTakePictureButton(),populateSelectNameTag(a)}function showTakePictureButton(){$("#save-picture-and-take-another-buttons-container").hide(),$("#mark-another-attendance-button-container").hide(),$("#take-picture-button-container").show()}function showSavePictureAndTakeAnotherButtonContainer(){$("#take-picture-button-container").hide(),$("#mark-another-attendance-button-container").hide(),$("#save-picture-and-take-another-buttons-container").show()}function showMarkAnotherAttendanceButton(){$("#save-picture-and-take-another-buttons-container").hide(),$("#take-picture-button-container").hide(),$("#mark-another-attendance-button-container").show()}function updateAttendanceTimerCount(){chrome.storage.local.get("attendanceData",function(a){var b=a.attendanceData;null!=b&&($.each(b,function(a,c){b[a].count=(parseInt(c.count)+10).toString()}),chrome.storage.local.set({attendanceData:b}))}),setTimeout(updateAttendanceTimerCount,1e4)}function loadEmployeeData(a,b){$.ajax({type:"GET",url:"http://manaple.com/api/get_employee_data.json",headers:{"x-api-email":a,"x-api-token":b},async:"true",error:function(){$("#message").html("Could not get employee data from server")},success:function(a){chrome.storage.local.set({employeeData:a}),populateSelectNameTag(a),populateEmployeeList(a)}})}function populateEmployeeList(a){$("#employee-list").html(""),$.each(a,function(a,b){$("#employee-list").append(b+"<br/>")})}function showLoginPage(){$(".page").hide(),$("#login-page").show()}function showAlreadyOnlinePage(){$(".page").hide(),$("#already-online-page").show()}function showNoEmployeeDataPage(){$(".page").hide(),$("#no-employee-data-page").show()}function showSpinner(){$("#spinner").show()}function hideSpinner(){$("#spinner").hide()}function checkForInternet(a){$.ajax({type:"HEAD",url:"http://manaple.com",async:"true",error:function(){$("#internet-status").html("Status: Offline"),"false"==a?(hideSpinner(),setTakePhotoPage()):setTimeout(checkForInternet,5e3)},success:function(){showAlreadyOnlinePage(),$("#message").html(""),$("#internet-status").html("Status: Online"),"false"==a&&hideSpinner(),chrome.storage.local.get("attendanceData",function(a){null!=a.attendanceData&&$("#attendance-data-stored-message").show()}),chrome.storage.local.get("employeeData",function(a){null!=a.employeeData?(employeeData=a.employeeData,populateEmployeeList(employeeData)):showNoEmployeeDataPage()})},beforeSend:function(){"false"==a&&($("#internet-status").html("Status: Checking"),showSpinner())}})}function populateSelectNameTag(a){null!=a?populateSelectTag("select-name",a):chrome.storage.local.get("employeeData",function(b){null!=b.employeeData?(a=b.employeeData,populateSelectTag("select-name",a)):showNoEmployeeDataPage()})}function populateSelectTag(a,b){var c=document.getElementById(a);c.options.length=0;for(var d in b){var e=b[d];c.options.add(new Option(e,d))}}document.addEventListener("DOMContentLoaded",function(){var a,b,d,e,f,c={},g={},h=chrome.storage.local;updateAttendanceTimerCount();var i=document.getElementById("spinner");(new Spinner).spin(i),h.get("employeeData",function(a){null!=a.employeeData?(g=a.employeeData,$.ajax({type:"HEAD",url:"http://manaple.com",async:"true",error:function(){setTakePhotoPage(g),checkForInternet("true")},success:function(){showAlreadyOnlinePage(),populateEmployeeList(g)}})):showNoEmployeeDataPage()}),h.get("attendanceData",function(a){null!=a.attendanceData&&$("#attendance-data-stored-message").show()}),$("#take-picture-button").click(function(){showSavePictureAndTakeAnotherButtonContainer();var a=document.getElementById("select-name");d=a.options[a.selectedIndex].value;var b="",g=$("input[type='radio'][name='attendance_description']:checked");g.length>0&&(b=g.val()),e=Webcam.snap(),f=e.replace(/^data\:image\/\w+\;base64\,/,""),$("#webcam").html('<img src="'+e+'"/>'),c={user_id:d,photo_data:e,count:"0",description:b}}),$("#save-picture-button").click(function(){h.get("attendanceData",function(a){if(null!=a.attendanceData){var b=a.attendanceData;b.push(c),h.set({attendanceData:b})}else h.set({attendanceData:[c]});$("#attendance-data-stored-message").show()}),showMarkAnotherAttendanceButton()}),$("#mark-another-attendance-button").click(function(){setTakePhotoPage()}),$("#take-another-picture-button").click(function(){setTakePhotoPage()}),$("#check-internet-connection-button").click(function(){checkForInternet("false")}),$(".load-employee-data-button").click(function(){null!=a?loadEmployeeData(b,a):showLoginPage()}),$("#sign-in-button").click(function(){var c=$("#user-email").val(),d=$("#user-password").val(),e={email:c,password:d};$.ajax({type:"POST",url:"http://manaple.com/users/sign_in.json",data:e,async:"true",error:function(a){$("#message").html(""),hideSpinner(),401==a.status?$("#message").html("Incorrect username or password"):($("#message").html("No Internet Connectivity Present!<br/> Check your connection and try again."),setTakePhotoPage(g))},success:function(c){$("#message").html(""),hideSpinner(),a=c.user.auth_token,b=c.user.email,sendAttendanceData(b,a),loadEmployeeData(b,a),showAlreadyOnlinePage()},beforeSend:function(){$("#message").html("Signing In"),showSpinner()}})}),$("#send-data-to-server-button").click(function(){null!=a?sendAttendanceData(email,a):($("#attendance-data-stored-message").hide(),$("#message").html(""),showLoginPage())})});

